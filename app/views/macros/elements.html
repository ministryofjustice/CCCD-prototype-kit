{% macro input(data, formcache={}, errorState=false) %}
  <div class="form-group {{ 'form-group-error' if errorState }}">
    <label class="form-label-bold {{'-bold' if data.bold }}" for="general-input-{{data.label | nameAttr}}">
      {{data.label | default('Missing data.label')}}

      {% if data.hint %}
      <span class="form-hint">
        {{data.hint}}
      </span>
      {% endif %}
      {% if errorState %}
      <span class="error-message">
        {{data.error | default('Missing data.error')}}
      </span>
      {% endif %}
    </label>
    {% set lookup = 'input-' + data.label | nameAttr %}
    <input class="form-control {{ 'form-group-error' if errorState }}" id="general-input-{{data.label | nameAttr}}" type="{{data.type | default('text')}}" name="input-{{data.label | nameAttr}}" value="{{formcache[lookup]}}">
  </div>
{% endmacro %}

{% macro radiogroup(data, formcache={}, errorState=false) %}
  {% set localname = 'radio-group-' + data.heading | nameAttr %}
  <div class="form-group {{ 'form-group-error' if errorState }}">
    <fieldset>
      <legend>
        <h1 class="heading-medium">
          {{data.heading | default('Missing data.heading')}}
        </h1>

        <span class="body-text">{{data.bodytext | default('Missing data.bodytext')}}</span>
        {% if errorState %}
        <span class="error-message">
          {{data.error | default('Missing data.error')}}
        </span>
        {% endif %}
      </legend>

      {% for item in data.options %}
      <div class="multiple-choice">
        <input id="radio-{{loop.index}}" type="radio" name="{{localname}}" value="{{item}}" {{'checked' if item == formcache[localname]}} />
        <label for="radio-{{loop.index}}">{{item}}</label>
      </div>
      {% endfor %}

    </fieldset>
  </div>
{% endmacro %}

{% macro date(data, formcache={}, errorState=false) %}
  <div class="form-group {{ 'form-group-error' if errorState }}">
    <fieldset>
      <legend>
        <span class="form-label-bold">
          {{data.legend | default('Missing data.lagend')}}
        </span>
        <span class="form-hint">For example, 31 3 1980</span>
        {% if errorState %}
        <span class="error-message">
          {{data.error | default('Missing data.error')}}
        </span>
        {% endif %}
      </legend>
      <div class="form-date">
      {% set lookupbase = data.legend | nameAttr %}
        <div class="form-group form-group-day">
          <label class="form-label" for="{{lookupbase}}-day">Day</label>
          <input class="form-control {{ 'form-control-error' if errorState }}" id="{{lookupbase}}-day" value="{{formcache[lookupbase+'-day']}}" name="{{lookupbase}}-day" type="number" pattern="[0-9]*" min="0" max="31">
        </div>
        <div class="form-group form-group-month">
          <label class="form-label" for="{{lookupbase}}-month">Month</label>
          <input class="form-control {{ 'form-control-error' if errorState }}" id="{{lookupbase}}-month" value="{{formcache[lookupbase+'-month']}}" name="{{lookupbase}}-month" type="number" pattern="[0-9]*" min="0" max="12">
        </div>
        <div class="form-group form-group-year">
          <label class="form-label" for="{{lookupbase}}-year">Year</label>
          <input class="form-control {{ 'form-control-error' if errorState }}" id="{{lookupbase}}-year" value="{{formcache[lookupbase+'-year']}}" name="{{lookupbase}}-year" type="number" pattern="[0-9]*" min="0" max="2016">
        </div>
      </div>
    </fieldset>
  </div>
{% endmacro %}

{% macro inputfieldset(data, formcache={}, errorState=false) %}
  <div class="form-group {{ 'form-group-error' if errorState }}">
    <fieldset>
      <legend>
        <span class="form-label-bold">
          {{data.legend | default('Missing data.legend')}}
        </span>
        <span class="form-hint">{{data.hint | default('For example, 31 3 1980')}}</span>
        {% if errorState %}
        <span class="error-message">
          {{data.error | default('Missing data.error')}}
        </span>
        {% endif %}
      </legend>
      <div class="form-date">
        <div class="form-group form-group-day">
          <label class="form-label" for="{{data.legend | nameAttr}}">{{data.label | default('Day')}}</label>
          <input class="form-control {{ 'form-control-error' if errorState }}" id="{{data.legend | nameAttr}}" name="{{data.legend | nameAttr}}" type="number" pattern="[0-9]*" min="0" max="31">
        </div>
      </div>
    </fieldset>
  </div>
{% endmacro %}

{% macro checkboxlist(data, formcache={}, errorState=false) %}
  {% set localname = 'checkbox-group-'+ data.heading | nameAttr %}
  {% if data.heading %}
  <h3 class="heading-medium">{{data.heading}}</h3>
  {% endif %}
  <div class="form-group {{ 'form-group-error' if errorState }}">
    <fieldset>
      <legend>
        {% if data.bodytext %}
        <span class="body-text">
          {{ data.bodytext }}
        </span>
        {% endif %}
        {% if errorState %}
        <span class="error-message">
          {{data.error | default('Missing data.error')}}
        </span>
        {% endif %}
      </legend>

      {% for item in data.options %}
      <div class="multiple-choice">
        <input id="checkbox-{{loop.index}}" type="checkbox" name="{{localname+ '-'+loop.index}}" value="{{item}}" {{'checked' if (item == formcache[localname+'-'+loop.index])}} />
        <label for="checkbox-{{loop.index}}">{{item}}</label>
      </div>
      {% endfor %}
    </fieldset>
  </div>
{% endmacro %}

{% macro addmore(data, formcache={}) %}
  <hr/>
  <div class="form-group">
    <input type="{{data.type | default('submit')}}" class="button button-secondary" value="{{data.value | default('Add another')}}" />
  </div>
{% endmacro %}

{% macro select(data, formcache={}, errorState=false) %}

  {% set localname = 'select-box-' + data.label | nameAttr %}

  <div class="form-group {{ 'form-group-error' if errorState }}">
    <label class="form-label-bold" for="select-box">
      {{data.label | default("Missing data.label")}}

      {% if data.hint %}
        <span class="form-hint">
          {{data.hint}}
        </span>
      {% endif %}


      {% if errorState %}
        <span class="error-message">
          {{data.error | default('Missing data.error')}}
        </span>
      {% endif %}
    </label>
    <select autocomplete="off"
      class="form-control
        {{ 'typeahead' if data.typeahead !== false }}
        {{ data.cssClasses if data.cssClasses }}
        {{ 'form-control-error' if errorState }}
        "
      {{ 'disabled' if data.readonly == true}}

      id="{{localname}}"

      name="{{localname}}"
      >

      <option value=""></option>

      {% if data.options[0] | is_string %}
        {% for item in data.options %}

          <option value="{{item}}" {{'selected' if formcache[localname]==item}}>{{item}}</option>
        {% endfor %}

      {% else %}
        {% for item in data.options %}
          <option
            {{'selected' if formcache[localname]==item.text}}
            {% for attr in item.dataAttrs %}
            data-{{attr | safe}}
            {% endfor %}
            data-trigger="{{item.trigger}}"
            value="{{item.text}}">
          {{item.text}}</option>
        {% endfor %}
      {% endif %}
    </select>
  </div>
{% endmacro %}

{% macro netamount(data, formcache={}, errorState=false) %}
  <div class="form-group {{ 'form-group-error' if errorState }}">
    <label class="form-label-bold" for="net-amount">
      Net amount
      {% if errorState %}
      <span class="error-message">
        {{data.error | default('Missing data.error')}}
      </span>
      {% endif %}
    </label>
    {% set lookup = 'input-' + (data.context | default('Missing data.context')) +'-'+(data.legend | nameAttr) %}
    <span class="input-group-prefix">£</span><input type="number" id="{{lookup}}" name="{{lookup}}" min="0.01" max="999999.99" step="0.01" class="form-control form-control-1-4 {{ 'form-control-error' if errorState }}" value="{{formcache[lookup]}}"/>
  </div>
{% endmacro %}

{% macro vatamount(data, formcache={}, errorState=false) %}
  <div class="form-group {{ 'form-group-error' if errorState }}">
    <label class="form-label-bold" for="net-amount">
      VAT amount
      {% if errorState %}
      <span class="error-message">
        {{data.error | default('Missing data.error')}}
      </span>
      {% endif %}
    </label>
    <span class="input-group-prefix">£</span><input type="number" id="vat-amount" name="vat-amount-{{data.legend | nameAttr}}" min="0.01" max="999999.99" step="0.01" class="form-control form-control-1-4 {{ 'form-control-error' if errorState }}"/>
  </div>
{% endmacro %}


{% macro costpermile(data, formcache={}, errorState=false) %}
  <div class="form-group {{ 'form-group-error' if errorState }}">
    <fieldset class="inline">
      <legend>
        <h1 class="heading-small">
          Cost per mile
        </h1>
        {% if errorState %}
        <span class="error-message">
          Error message about personal details goes here
        </span>
      </legend>
      {% endif %}
      <div class="multiple-choice">
        <input id="radio-inline-1" type="radio" name="radio-inline-group" value="25">
        <label for="radio-inline-1">25p per mile</label>
      </div>
      <div class="multiple-choice">
        <input id="radio-inline-2" type="radio" name="radio-inline-group" value="45">
        <label for="radio-inline-2">45p per mile</label>
      </div>
    </fieldset>
  </div>
{% endmacro %}
