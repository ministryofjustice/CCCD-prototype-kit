{% macro input(data,formcache={}, seedNum=1) %}
  {% set contextID = (data.context | default('general')) +'-input-' + (data.label | nameAttr) + '-' + seedNum %}
  <div class="form-group el-input {{ 'form-group-error' if errorState }} {{ 'hidden' if data.hidden }}" id="wrapped-{{contextID}}">
    <label class="form-label-bold" for="{{ contextID }}">
      {{data.label | default('Missing data.label')}}

      {% if data.hint %}
      <span class="form-hint">
        {{data.hint}}
      </span>
      {% endif %}
      {% if errorState %}
      <span class="error-message">
        {{data.error | default('Missing data.error')}}
      </span>
      {% endif %}
    </label>
    <input
      class="form-control {{ 'form-group-error' if errorState }} {{ 'disabled' if data.readonly == true}} {{ data.cssClasses if data.cssClasses }}"
      id="{{ contextID }}"
      type="{{data.type | default('text')}}"
      name="{{ contextID }}"
      value="{{formcache[contextID]}}"
      {{ 'disabled' if data.readonly == true}}
      {{ 'data-uppercase=true' if data.uppercase == true}}
    />
  </div>
{% endmacro %}

{% macro radiogroup(data, formcache={}, seedNum=1) %}
  {% set contextID = (data.context | default('general')) +'-radio-group-' + (data.heading | nameAttr) + '-' + seedNum %}
  <div class="form-group {{ 'form-group-error' if errorState }}" id="wrapped-{{contextID}}">
    <fieldset>
      <legend>
        <h1 class="heading-medium">
          {{data.heading | default('Missing data.heading')}}
        </h1>

        <span class="body-text">{{data.bodytext | default('Missing data.bodytext')}}</span>
        {% if errorState %}
        <span class="error-message">
          {{data.error | default('Missing data.error')}}
        </span>
        {% endif %}
      </legend>

      {% for item in data.options %}
      <div class="multiple-choice">
        <input id="{{contextID}}-{{loop.index}}" type="radio" name="{{contextID}}" value="{{item}}" {{'checked' if item == formcache[contextID]}} />
        <label for="{{contextID}}-{{loop.index}}">{{item}}</label>
      </div>
      {% endfor %}

    </fieldset>
  </div>
{% endmacro %}

{% macro date(data, formcache={}, seedNum=1) %}
  {% set contextID = (data.context | default('general')) + '-' + (data.legend | nameAttr) + '-' + seedNum %}

  <!-- THERE IS A BUG HERE
    YOu will not be able to change the date
       -->
  <div class="form-group {{ 'form-group-error' if errorState }}  {{ 'fx-populate' if data.populate }}"
  {{ "data-contextID=" + contextID if data.populate }} >
    <fieldset>
      <legend>
        <span class="form-label-bold">
          {{data.legend | default('Missing data.lagend')}}
        </span>
        <span class="form-hint">{{(data.hint | default('For example, 31 3 1980')) if (data.showhint | default(true))}}</span>
        {% if errorState %}
        <span class="error-message">
          {{data.error | default('Missing data.error')}}
        </span>
        {% endif %}
      </legend>
      <div class="form-date">
        <div class="form-group form-group-day">
          <label class="form-label" for="{{contextID}}-day">Day</label>
          <input class="form-control {{ 'form-control-error' if errorState }}" id="{{contextID}}-day" value="{{formcache[contextID+'-day']}}" name="{{contextID}}-day" type="number" pattern="[0-9]*" min="0" max="31">
        </div>
        <div class="form-group form-group-month">
          <label class="form-label" for="{{contextID}}-month">Month</label>
          <input class="form-control {{ 'form-control-error' if errorState }}" id="{{contextID}}-month" value="{{formcache[contextID+'-month']}}" name="{{contextID}}-month" type="number" pattern="[0-9]*" min="0" max="12">
        </div>
        <div class="form-group form-group-year">
          <label class="form-label" for="{{contextID}}-year">Year</label>
          <input class="form-control {{ 'form-control-error' if errorState }}" id="{{contextID}}-year" value="{{formcache[contextID+'-year']}}" name="{{contextID}}-year" type="number" pattern="[0-9]*" min="0" max="2017">
        </div>
      </div>
    </fieldset>
  </div>
{% endmacro %}

{% macro inputfieldset(data, formcache={}, errorState=false) %}
  <div class="form-group {{ 'form-group-error' if errorState }}">
    <fieldset>
      <legend>
        <span class="form-label-bold">
          {{data.legend | default('Missing data.legend')}}
        </span>
        <span class="form-hint">{{data.hint | default('For example, 31 3 1980')}}</span>
        {% if errorState %}
        <span class="error-message">
          {{data.error | default('Missing data.error')}}
        </span>
        {% endif %}
      </legend>
      <div class="form-date">
        <div class="form-group form-group-day">
          <label class="form-label" for="{{data.legend | nameAttr}}">{{data.label | default('Day')}}</label>
          <input class="form-control {{ 'form-control-error' if errorState }}" id="{{data.legend | nameAttr}}" name="{{data.legend | nameAttr}}" type="number" pattern="[0-9]*" min="0" max="31">
        </div>
      </div>
    </fieldset>
  </div>
{% endmacro %}

{% macro checkboxlist(data, formcache={}, errorState=false) %}
  {% set localname = 'checkbox-group-'+ data.heading | nameAttr %}
  {% if data.heading %}
  <h3 class="heading-medium">{{data.heading}}</h3>
  {% endif %}
  <div class="form-group {{ 'form-group-error' if errorState }}">
    <fieldset>
      <legend>
        {% if data.bodytext %}
        <span class="body-text">
          {{ data.bodytext }}
        </span>
        {% endif %}
        {% if errorState %}
        <span class="error-message">
          {{data.error | default('Missing data.error')}}
        </span>
        {% endif %}
      </legend>

      {% for item in data.options %}
      <div class="multiple-choice">
        <input id="checkbox-{{loop.index}}" type="checkbox" name="{{localname+ '-'+loop.index}}" value="{{item}}" {{'checked' if (item == formcache[localname+'-'+loop.index])}} />
        <label for="checkbox-{{loop.index}}">{{item}}</label>
      </div>
      {% endfor %}
    </fieldset>
  </div>
{% endmacro %}

{% macro addmore(data, formcache={}) %}

  <div class="form-group fx-duplicate" data-selector="{{data.fxselector}}">
    <input type="{{data.type | default('submit')}}" class="button button-secondary" value="{{data.value | default('Add another')}}" />
  </div>
{% endmacro %}

{% macro select(data, formcache={}, seedNum=1) %}
  {% set contextID = (data.context | default('general')) +'-select-' + (data.label | nameAttr) + '-' + seedNum %}
  <div class="form-group {{ 'form-group-error' if errorState }}">
    <label class="form-label-bold" for="{{contextID}}">
      {{data.label | default("Missing data.label")}}

      {% if data.hint %}
        <span class="form-hint">
          {{data.hint}}
        </span>
      {% endif %}


      {% if errorState %}
        <span class="error-message">
          {{data.error | default('Missing data.error')}}
        </span>
      {% endif %}
    </label>
    <select autocomplete="off"
      class="form-control
        {{ 'typeahead' if data.typeahead !== false }}
        {{ data.cssClasses if data.cssClasses }}
        {{ 'form-control-error' if errorState }}
        "
      {{ 'disabled' if data.readonly == true}}

      id="{{contextID}}"

      name="{{contextID}}"
      >

      {% if not data.emptyOption %}
        <option value=""></option>
      {% else %}
        <option value="">Please select ...</option>
      {% endif %}

      {% if data.options[0] | is_string %}
        {% for item in data.options %}

          <option value="{{item}}" {{'selected' if formcache[contextID]==item}}>{{item}}</option>
        {% endfor %}

      {% else %}
        {% for item in data.options %}
          <option
            {{'selected' if formcache[contextID]==item.text}}
            {% for attr in item.dataAttrs %}
            data-{{attr | safe}}
            {% endfor %}
            data-trigger="{{item.trigger}}"
            value="{{item.text}}">
          {{item.text}}</option>
        {% endfor %}
      {% endif %}
    </select>
  </div>
{% endmacro %}

{% macro netamount(data, formcache={}, seedNum=1) %}
  {% set contextID = (data.context | default('general')) +'-input-' + (data.legend | nameAttr) + '-' + seedNum %}

  <div class="form-group {{ 'form-group-error' if errorState }}">
    <label class="form-label-bold" for="{{contextID}}">
      Net amount
      {% if errorState %}
      <span class="error-message">
        {{data.error | default('Missing data.error')}}
      </span>
      {% endif %}
    </label>
    <span class="input-group-prefix">£</span><input

      id="{{contextID}}"
      name="{{contextID}}"
      value="{{formcache[contextID]}}"
      class="form-control form-control-1-4 {{ 'form-control-error' if errorState }}"

      type="number"
      min="0.01"
      max="999999.99"
      step="0.01"
    />
  </div>
{% endmacro %}

{% macro vatamount(data, formcache={}, errorState=false) %}
  <div class="form-group {{ 'form-group-error' if errorState }}">
    {% set lookup = 'input-' + (data.context | default('Missing data.context')) +'-'+(data.legend | nameAttr) %}
    <label class="form-label-bold" for="{{lookup}}">
      VAT amount
      {% if errorState %}
      <span class="error-message">
        {{data.error | default('Missing data.error')}}
      </span>
      {% endif %}
    </label>
    <span class="input-group-prefix">£</span><input

      id="{{lookup}}"
      name="{{lookup}}"
      value="{{formcache[lookup]}}"
      class="form-control form-control-1-4 {{ 'form-control-error' if errorState }}"

      type="number"
      min="0.01"
      max="999999.99"
      step="0.01"

    />
  </div>
{% endmacro %}

{% macro costpermile(data, formcache={}, errorState=false) %}
  <div class="form-group {{ 'form-group-error' if errorState }} fx-for-travel">
    <fieldset class="inline">
      <legend>
        <h1 class="heading-small">
          Cost per mile
        </h1>
        {% if errorState %}
        <span class="error-message">
          Error message about personal details goes here
        </span>
      </legend>
      {% endif %}
      <div class="multiple-choice">
        <input id="radio-inline-1" type="radio" name="travel-expence-cpm" value="25"

           {{'checked' if "25" == (formcache['travel-expence-cpm'] | default('25'))}}

        />
        <label for="radio-inline-1">25p per mile</label>
      </div>
      <div class="multiple-choice">
        <input id="radio-inline-2" type="radio" name="travel-expence-cpm" value="45"

          {{'checked' if "45" == formcache['travel-expence-cpm']}}

        />
        <label for="radio-inline-2">45p per mile</label>
      </div>
    </fieldset>
  </div>
{% endmacro %}


{% macro miscfee(data, formcache, FORM, seedNum=1) %}

  <div class="fx-misc-fee {{ 'hidden' if (seedNum > 1)}}">


    <h3 class="heading-medium">
      Item {{seedNum}}
    </h3>
    <div class="form-section">
      {{FORM.select(data[0], formcache, seedNum)}}
      {{FORM.input(data[1], formcache, seedNum)}}
      {{FORM.netamount(data[2], formcache, seedNum)}}
    </div>
    <hr />


  </div>
{% endmacro %}

{% macro trialdetails(data, formcache, FORM, keylookup) %}
  <h3 class="heading-medium">
    Trail details
  </h3>

  <div class="grid-row">

    <div class="column-one-half">
      <div class="form-section">
        {{FORM.date(data[keylookup[0]], formcache)}}
      </div>
    </div>

    <div class="column-one-half">
      <div class="form-section">
        {{FORM.inputfieldset(data[keylookup[1]], formcache)}}
      </div>
    </div>
  </div>

  <div class="grid-row">
    <div class="column-one-half">
      <div class="form-section">
        {{FORM.date(data[keylookup[2]], formcache)}}
      </div>
    </div>

    <div class="column-one-half">
      <div class="form-section">
        {{FORM.inputfieldset(data[keylookup[3]], formcache)}}
      </div>
    </div>
  </div>
{% endmacro %}
